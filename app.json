const express = require('express');
const crypto = require('crypto');

const app = express();
app.use(express.json());

// API keys temporarily memory එකේ තියාගන්න set එකක්
const apiKeys = new Set();

// Random API key generate කරන function
function generateApiKey() {
  return crypto.randomBytes(16).toString('hex');  // 32 char hex string
}

// API key generate කරලා දෙන්න POST endpoint එක
app.post('/generate-key', (req, res) => {
  const newKey = generateApiKey();
  apiKeys.add(newKey);
  res.json({ apiKey: newKey });
});

// Secure data access කරන GET endpoint එක
app.get('/secure-data', (req, res) => {
  const key = req.headers['x-api-key'];
  if (!key || !apiKeys.has(key)) {
    return res.status(401).send('Unauthorized - Invalid API key');
  }
  res.send('Secret Data only for authorized API key users!');
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
